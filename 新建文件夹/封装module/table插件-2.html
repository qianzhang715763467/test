<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>table 插件</title>
		<!--<link rel="stylesheet" type="text/css" href="../测试/css/init.css"/>-->
		<style type="text/css">
			html,body{width: 100%;height: 100%;margin: 0;padding: 0;}
		</style>
	</head>
	<body>
	</body>
	<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
	<script type="text/javascript">
		var obj = {
			"details":{
				"values2":[
					{"clus_label":"0.0","channel_count":64,"cent_channel":"SMS_DCM1Y0321","descr":"SMS_DCM1Y0321"},
					{"clus_label":"1.0","channel_count":25,"cent_channel":"HD_culture","descr":"HD_culture"},
					{"clus_label":"2.0","channel_count":35,"cent_channel":"F_fansshake0514a","descr":"F_fansshake0514a"},
					{"clus_label":"3.0","channel_count":27,"cent_channel":"F_newspapercqcb0419","descr":"F_newspapercqcb0419"},
					{"clus_label":"4.0","channel_count":3,"cent_channel":"HD_XWSCAN0401","descr":"HD_XWSCAN0401"},
					/*{"clus_label":"5.0","channel_count":103,"cent_channel":"SMS_DCYsssssssssssssssssssssssssZ0420PO","descr":"SMS_DCYZ0420PO"},*/
					{"clus_label":"6.0","channel_count":2,"cent_channel":"AppStore","descr":"AppStore"},
					{"clus_label":"0.0","channel_count":64,"cent_channel":"SMS_DCM1Y0321","descr":"SMS_DCM1Y0321"},
					{"clus_label":"1.0","channel_count":25,"cent_channel":"HD_culture","descr":"HD_culture"},
					{"clus_label":"2.0","channel_count":35,"cent_channel":"F_fansshake0514a","descr":"F_fansshake0514a"},
					{"clus_label":"3.0","channel_count":27,"cent_channel":"F_newspapercqcb0419","descr":"F_newspapercqcb0419"},
					{"clus_label":"4.0","channel_count":3,"cent_channel":"HD_XWSCAN0401","descr":"HD_XWSCAN0401"},
					{"clus_label":"5.0","channel_count":103,"cent_channel":"SMS_DCYZ0420PO","descr":"SMS_DCYZ0420PO"},
					{"clus_label":"6.0","channel_count":2,"cent_channel":"AppStore","descr":"AppStore"},
					{"clus_label":"0.0","channel_count":64,"cent_channel":"SMS_DCM1Y0321","descr":"SMS_DCM1Y0321"},
					{"clus_label":"1.0","channel_count":25,"cent_channel":"HD_culture","descr":"HD_culture"},
					{"clus_label":"2.0","channel_count":35,"cent_channel":"F_fansshake0514a","descr":"F_fansshake0514a"},
					{"clus_label":"3.0","channel_count":27,"cent_channel":"F_newspapercqcb0419","descr":"F_newspapercqcb0419"},
					{"clus_label":"4.0","channel_count":3,"cent_channel":"HD_XWSCAN0401","descr":"HD_XWSCAN0401"},
					{"clus_label":"5.0","channel_count":103,"cent_channel":"SMS_DCYZ0420PO","descr":"SMS_DCYZ0420PO"},
					{"clus_label":"6.0","channel_count":2,"cent_channel":"AppStore","descr":"AppStore"},
					{"clus_label":"0.0","channel_count":64,"cent_channel":"SMS_DCM1Y0321","descr":"SMS_DCM1Y0321"},
					{"clus_label":"1.0","channel_count":25,"cent_channel":"HD_culture","descr":"HD_culture"},
					{"clus_label":"2.0","channel_count":35,"cent_channel":"F_fansshake0514a","descr":"F_fansshake0514a"},
					{"clus_label":"3.0","channel_count":27,"cent_channel":"F_newspapercqcb0419","descr":"F_newspapercqcb0419"},
					{"clus_label":"4.0","channel_count":3,"cent_channel":"HD_XWSCAN0401","descr":"HD_XWSCAN0401"},
					{"clus_label":"5.0","channel_count":103,"cent_channel":"SMS_DCYZ0420PO","descr":"SMS_DCYZ0420PO"},
					{"clus_label":"6.0","channel_count":2,"cent_channel":"AppStore","descr":"AppStore"},
					{"clus_label":"7.0","channel_count":3,"cent_channel":"promotion","descr":"promotion"}
				],
				"values1":[
					{"clus_label":"类别2","channel_count":"渠道个数","cent_channel":"类中心点","descr":"类特征描述"}
				],
				}
			};
			
	$.fn.extend({
		thValue 	 : obj.details.values1,
		tdValue 	 : obj.details.values2,
		averageWidth : false,
		handleEvent  : function(){
			var tab = {
				warp : this.warp,
				thV  : this.thValue,
				tdV  : this.tdValue,
				averageWidth : this.averageWidth,
				main : $('<section class="model-tab"></section>'),
				head : $('<div class="head-tab"></div>'),
				body : $('<div class="body-tab"></div>'),
				tab  : $('<table border="1" cellspacing="0" cellpadding="0"></table>'),
				styles:{
					boxModel:{
						mWidth	: '1000px',
						mHeight	: '500px',
						lineTh	: 40,
						lineTd	: 30,
						minWidth: '120px'   
					},
					scroll : { // overflow
						mXsc : 'auto',
						mYsc : 'hidden',
						hXsc : 'hidden',
						hYsc : 'hidden',
						bXsc : 'hidden',
						bYsc : 'auto'
					}
				},
				initStyle : function(self){
					self.main.find('*').css({
						'margin' :'0',
						'padding':'0',
						'box-sizing': 'border-box'
					});
					self.main.css({
						'width' 	: self.styles.boxModel.mWidth,
						'height'	: self.styles.boxModel.mHeight,
						'overflow-x': self.styles.scroll.mXsc,
						'overflow-y': self.styles.scroll.mYsc,
						'margin'    : '0 auto',
						'padding'   : '0',
						'text-align': 'center',
						'box-sizing': 'border-box'
					});
					self.head.css({
						'overflow-x' : self.styles.scroll.hXsc,
						'overflow-y' : self.styles.scroll.hYsc
					});
					self.body.css({
						'overflow-x' : self.styles.scroll.bXsc,
						'overflow-y' : self.styles.scroll.bYsc
					});
					self.main.find('table').css({'width':'100%'});
					self.main.find('th').css({
						'line-height': self.styles.boxModel.lineTh+'px',
						'min-width'	 : self.styles.boxModel.minWidth
					});
					self.main.find('td').css({
						'line-height': self.styles.boxModel.lineTd+'px',
						'min-width'	 : self.styles.boxModel.minWidth
					});
					// 根据实际内容调整 高度
					self.widthAdaptation(self);
					self.heightAdaptation(self);
				},
				createModel : function(self){
					console.log(self)
					self.warp.append(self.main);
					self.main.append(self.head.html(self.tab));
					self.main.append(self.body.html(self.tab.clone(true)));
				},
				createTh : function(self){
					self.arrKey = [];
					self.thRow = self.thV.length;
					for(var i = 0; i < self.thV.length; i++){
						var tr = $('<tr></tr>');
						for(var k in self.thV[i]){
							var th = '<th>'+ self.thV[i][k] +'</th>';
							if(i == 0){
								self.arrKey.push(k);
							};
							tr.append(th);
						};
						self.head.children(self.tab).append(tr);
					};
				},
				createTd : function(self){
					for(var i = 0; i < self.tdV.length; i++){
						var tr = $('<tr></tr>');
						for(var k = 0; k < self.arrKey.length; k++){
							var keY = self.arrKey[k];
							var td = '<td>'+ self.tdV[i][keY] +'</td>';
							tr.append(td);
						};
						self.body.children(self.tab).append(tr);
					};
				},
				widthAdaptation : function(self){
					var firstTh = self.head.find('tr:first-child').children('th');
					var firstTd = self.body.find('tr:first-child').children('td');
					var max1 = 0;
					var max2 = 0;
					var list = null; // 宽度最大的一组对象；
					// 获取 th,td 各自最大宽度；
					for(var i = 0;i < firstTh.length; i++){
						if($(firstTh[i]).width() > max1){
							max1 = $(firstTh[i]).width();
						};
						if($(firstTd[i]).width() > max2){
							max2 = $(firstTd[i]).width();
						};
					};
					// 获取最大宽度
					max1 > max2 ? list = firstTh : list = firstTd;
					console.log(list)
					// 需要表格宽度均分？
					if(!self.averageWidth){
						for(var i = 0;i < list.length; i++){
							var size = $(list[i]).outerWidth();
							if(max1 > max2){
								self.body.find('td').eq(i).css({
									'min-width' : size+'px',
									'max-width' : size+'px'
								});
							}else{
								self.head.find('th').eq(i).css({
									'min-width' : size+'px',
									'max-width' : size+'px'
								});
							}
						}
						var minTabW = self.body.children('table').outerWidth();
						// 改变 tab-head,tab-body 宽度
						self.head.css({'width':minTabW});
						self.body.css({'width':minTabW+17});
					}else{
						// min width
						var min  = self.styles.boxModel.minWidth;
						// 如果字节最长td.width() < 初始值，td.width = 初始值。
						if(max1 <= min-2 && max2 <= min-2){
							self.main.find('th,td').css('min-width',min);
						}else{
							if(max1 > max2){
								self.main.find('th,td').css({
									'min-width': max1+2+'px' ,
									'max-width': max1+2+'px'
								});
							}else{
								self.main.find('th,td').css({
									'min-width': max2+2+'px',
									'max-width': max2+2+'px'
								});
							};
							// 改变 tab-head,tab-body 宽度
							self.head.css({'width':self.head.children(self.tab).outerWidth()});
							self.body.css({'width':self.body.children(self.tab).outerWidth()});
						}
					}
					
				},
				heightAdaptation : function(self){
					// th标题行数 * (单行高度 + border)+table.border
					var h1 = self.thRow * (self.styles.boxModel.lineTh+2)+2;
					var h2 = self.main.height() - h1;
					self.head.css('height',h1);
					// body-table 去掉X轴滚动条的高度？
					if(h2 <= self.body.children().outerHeight()){
						h2 = h2 - 17;
					};
					// top: -2px ,解决两个table交界处边框过宽
					self.body.css({'position':'relative','top':'-2px','height':h2});
				},
				init:function(){
					// fn
					this.createModel(this);
					this.createTh(this);
					this.createTd(this);
					// style
					this.initStyle(this);
				}
			};
			return tab
			
		}
	});    
	$("body").handleEvent();
	</script>
</html>
